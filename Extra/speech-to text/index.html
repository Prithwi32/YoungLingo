<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Learning</title>
</head>
<body>
    <h1>Listen and Type</h1>
    <audio id="audio" controls></audio>
    <button id="generate">Generate Voice Sentence</button>
    <input type="text" id="userInput" placeholder="Type what you heard">
    <button id="submit">Submit</button>
    <p id="result"></p>

    <script>
        let correctSentence = "";

    document.getElementById('generate').addEventListener('click', async () => {
    try{
        const response = await fetch('http://127.0.0.1:5000/generate-voice');
    const data = await response.json();
    correctSentence = data.sentence;
    
    console.log("Audio URL:", data.audio_url);
    console.log("Sentence:", data.sentence);

    // Play audio
    const audio = document.getElementById('audio');
    audio.src = `http://127.0.0.1:5000${data.audio_url}`//data.audio_url + `?t=${new Date().getTime()}`; // Prevent caching by appending a timestamp
    audio.load(); // Reload the audio
    audio.play(); // Play the audio
    }
    catch(error){
        console.error("Error fetching audio:", error);
    }
});


document.getElementById('submit').addEventListener('click', async () => {
const userInput = document.getElementById('userInput').value;

const response = await fetch('http://127.0.0.1:5000/validate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user_input: userInput, correct_sentence: correctSentence }),
            });
            const data = await response.json();
            document.getElementById('result').innerText = `Result: ${data.result} (Similarity: ${data.similarity}%)`;
        });
    </script>
</body>
</html>
